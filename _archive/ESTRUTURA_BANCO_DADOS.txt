â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ESTRUTURA DO BANCO DE DADOS                          â”‚
â”‚                         AGRO INTELIGENTE                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         SISTEMA DE AUTENTICAÃ‡ÃƒO                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  auth.users (Supabase Auth)                                             â”‚
â”‚  â”œâ”€ id (UUID)                                                           â”‚
â”‚  â”œâ”€ email                                                               â”‚
â”‚  â”œâ”€ raw_user_meta_data                                                  â”‚
â”‚  â”‚   â”œâ”€ full_name                                                       â”‚
â”‚  â”‚   â”œâ”€ farm_id  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                       â”‚
â”‚  â”‚   â””â”€ role                    â”‚                                       â”‚
â”‚  â””â”€ created_at                  â”‚                                       â”‚
â”‚                                 â”‚                                       â”‚
â”‚                                 â”‚ TRIGGER: Sincroniza automaticamente   â”‚
â”‚                                 â–¼                                       â”‚
â”‚  user_profiles                                                          â”‚
â”‚  â”œâ”€ id (UUID)                                                           â”‚
â”‚  â”œâ”€ user_id (FK â†’ auth.users)                                          â”‚
â”‚  â”œâ”€ email                                                               â”‚
â”‚  â”œâ”€ full_name                                                           â”‚
â”‚  â”œâ”€ farm_id â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                       â”‚
â”‚  â”œâ”€ role (owner/member)        â”‚                                       â”‚
â”‚  â”œâ”€ subscription_plan          â”‚                                       â”‚
â”‚  â”œâ”€ subscription_status        â”‚                                       â”‚
â”‚  â””â”€ created_at                 â”‚                                       â”‚
â”‚                                â”‚                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PAINEL DE ADMINISTRAÃ‡ÃƒO                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                â”‚                                       â”‚
â”‚  admin_users                   â”‚                                       â”‚
â”‚  â”œâ”€ id (UUID)                  â”‚                                       â”‚
â”‚  â”œâ”€ email â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                                       â”‚
â”‚  â”œâ”€ role (root/admin)       â”‚  â”‚                                       â”‚
â”‚  â””â”€ created_at              â”‚  â”‚                                       â”‚
â”‚                             â”‚  â”‚                                       â”‚
â”‚  ADMIN ROOT:                â”‚  â”‚                                       â”‚
â”‚  wallisom_53@outlook.com â”€â”€â”€â”˜  â”‚                                       â”‚
â”‚                                â”‚                                       â”‚
â”‚  PERMISSÃ•ES:                   â”‚                                       â”‚
â”‚  âœ… Ver todos os usuÃ¡rios      â”‚                                       â”‚
â”‚  âœ… Editar planos              â”‚                                       â”‚
â”‚  âœ… Alterar status             â”‚                                       â”‚
â”‚                                â”‚                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â”‚ ISOLAMENTO POR FARM_ID
                                 â”‚ (RLS - Row Level Security)
                                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DADOS DA APLICAÃ‡ÃƒO                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                â”‚                                       â”‚
â”‚  crops (Safras)                â”‚                                       â”‚
â”‚  â”œâ”€ id                         â”‚                                       â”‚
â”‚  â”œâ”€ name                       â”‚                                       â”‚
â”‚  â”œâ”€ area                       â”‚                                       â”‚
â”‚  â”œâ”€ stage                      â”‚                                       â”‚
â”‚  â”œâ”€ progress                   â”‚                                       â”‚
â”‚  â”œâ”€ farm_id â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                       â”‚
â”‚  â””â”€ created_at                 â”‚                                       â”‚
â”‚                                â”‚                                       â”‚
â”‚  machines (MÃ¡quinas)           â”‚                                       â”‚
â”‚  â”œâ”€ id                         â”‚                                       â”‚
â”‚  â”œâ”€ name                       â”‚                                       â”‚
â”‚  â”œâ”€ type                       â”‚                                       â”‚
â”‚  â”œâ”€ status                     â”‚                                       â”‚
â”‚  â”œâ”€ hours                      â”‚                                       â”‚
â”‚  â”œâ”€ farm_id â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                       â”‚
â”‚  â””â”€ created_at                 â”‚                                       â”‚
â”‚                                â”‚                                       â”‚
â”‚  activities (Atividades)       â”‚                                       â”‚
â”‚  â”œâ”€ id                         â”‚                                       â”‚
â”‚  â”œâ”€ title                      â”‚                                       â”‚
â”‚  â”œâ”€ description                â”‚                                       â”‚
â”‚  â”œâ”€ status                     â”‚                                       â”‚
â”‚  â”œâ”€ type                       â”‚                                       â”‚
â”‚  â”œâ”€ farm_id â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                       â”‚
â”‚  â””â”€ created_at                 â”‚                                       â”‚
â”‚                                â”‚                                       â”‚
â”‚  livestock (PecuÃ¡ria)          â”‚                                       â”‚
â”‚  â”œâ”€ id                         â”‚                                       â”‚
â”‚  â”œâ”€ tag                        â”‚                                       â”‚
â”‚  â”œâ”€ type                       â”‚                                       â”‚
â”‚  â”œâ”€ breed                      â”‚                                       â”‚
â”‚  â”œâ”€ weight                     â”‚                                       â”‚
â”‚  â”œâ”€ status                     â”‚                                       â”‚
â”‚  â”œâ”€ farm_id â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                       â”‚
â”‚  â””â”€ created_at                 â”‚                                       â”‚
â”‚                                â”‚                                       â”‚
â”‚  inventory_items (Estoque)     â”‚                                       â”‚
â”‚  â”œâ”€ id                         â”‚                                       â”‚
â”‚  â”œâ”€ name                       â”‚                                       â”‚
â”‚  â”œâ”€ category                   â”‚                                       â”‚
â”‚  â”œâ”€ quantity                   â”‚                                       â”‚
â”‚  â”œâ”€ status                     â”‚                                       â”‚
â”‚  â”œâ”€ farm_id â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                       â”‚
â”‚  â””â”€ created_at                 â”‚                                       â”‚
â”‚                                â”‚                                       â”‚
â”‚  team_members (Equipe)         â”‚                                       â”‚
â”‚  â”œâ”€ id                         â”‚                                       â”‚
â”‚  â”œâ”€ name                       â”‚                                       â”‚
â”‚  â”œâ”€ role                       â”‚                                       â”‚
â”‚  â”œâ”€ email                      â”‚                                       â”‚
â”‚  â”œâ”€ status                     â”‚                                       â”‚
â”‚  â”œâ”€ farm_id â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                       â”‚
â”‚  â””â”€ created_at                 â”‚                                       â”‚
â”‚                                â”‚                                       â”‚
â”‚  messages (Chat) [REALTIME]    â”‚                                       â”‚
â”‚  â”œâ”€ id                         â”‚                                       â”‚
â”‚  â”œâ”€ content                    â”‚                                       â”‚
â”‚  â”œâ”€ sender_id                  â”‚                                       â”‚
â”‚  â”œâ”€ sender_name                â”‚                                       â”‚
â”‚  â”œâ”€ read                       â”‚                                       â”‚
â”‚  â”œâ”€ farm_id â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                       â”‚
â”‚  â””â”€ created_at                                                         â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        SEGURANÃ‡A E ISOLAMENTO                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  ğŸ”’ ROW LEVEL SECURITY (RLS)                                           â”‚
â”‚  â”œâ”€ Ativo em TODAS as tabelas                                         â”‚
â”‚  â”œâ”€ UsuÃ¡rios sÃ³ veem dados do seu farm_id                             â”‚
â”‚  â””â”€ Admins veem TODOS os dados                                        â”‚
â”‚                                                                         â”‚
â”‚  ğŸ”‘ POLÃTICAS DE ACESSO                                                â”‚
â”‚  â”œâ”€ SELECT: farm_id = user.farm_id OR user.is_admin                  â”‚
â”‚  â”œâ”€ INSERT: farm_id = user.farm_id                                   â”‚
â”‚  â”œâ”€ UPDATE: farm_id = user.farm_id OR user.is_admin                  â”‚
â”‚  â””â”€ DELETE: farm_id = user.farm_id                                   â”‚
â”‚                                                                         â”‚
â”‚  âš¡ TRIGGERS AUTOMÃTICOS                                               â”‚
â”‚  â”œâ”€ Sincroniza auth.users â†’ user_profiles                            â”‚
â”‚  â”œâ”€ Atualiza updated_at automaticamente                              â”‚
â”‚  â””â”€ Valida farm_id ao inserir dados                                  â”‚
â”‚                                                                         â”‚
â”‚  ğŸ“¡ REALTIME                                                           â”‚
â”‚  â””â”€ Habilitado para messages (chat em tempo real)                    â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           FLUXO DE DADOS                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  1. NOVO USUÃRIO SE CADASTRA                                           â”‚
â”‚     â””â”€â–º auth.users (Supabase cria)                                    â”‚
â”‚         â””â”€â–º TRIGGER: handle_new_user()                                â”‚
â”‚             â””â”€â–º user_profiles (criado automaticamente)                â”‚
â”‚                 â””â”€â–º farm_id gerado (se owner) ou fornecido (se member)â”‚
â”‚                                                                         â”‚
â”‚  2. USUÃRIO FAZ LOGIN                                                  â”‚
â”‚     â””â”€â–º JWT contÃ©m: email, farm_id, role                             â”‚
â”‚         â””â”€â–º RLS usa farm_id para filtrar dados                       â”‚
â”‚             â””â”€â–º UsuÃ¡rio vÃª APENAS dados da sua fazenda               â”‚
â”‚                                                                         â”‚
â”‚  3. ADMIN ACESSA PAINEL                                                â”‚
â”‚     â””â”€â–º Verifica se email estÃ¡ em admin_users                        â”‚
â”‚         â””â”€â–º Se SIM: acessa /admin                                    â”‚
â”‚             â””â”€â–º VÃª TODOS os usuÃ¡rios e pode editar                   â”‚
â”‚                                                                         â”‚
â”‚  4. USUÃRIO CRIA DADOS (ex: safra)                                     â”‚
â”‚     â””â”€â–º INSERT em crops                                               â”‚
â”‚         â””â”€â–º RLS valida: farm_id = user.farm_id                       â”‚
â”‚             â””â”€â–º Se OK: dados salvos                                  â”‚
â”‚                 â””â”€â–º Outros usuÃ¡rios da mesma fazenda veem            â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ÃNDICES DE PERFORMANCE                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  âš¡ Todas as tabelas tÃªm Ã­ndice em farm_id                            â”‚
â”‚  âš¡ user_profiles indexado por email e farm_id                        â”‚
â”‚  âš¡ Queries otimizadas para busca rÃ¡pida                              â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
